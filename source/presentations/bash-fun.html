---
layout: slide
title: "Functional programming in Bash"
reveal:
    theme: league
    controls: true
    progress: true
    history: true
    transition: slide
    center: true
---

<section>
    <section>
        <h2>{{ page.title }}</h2>

        <p>Introduction to fun.sh library</p>

        <p>
            <small>L2L Warszawa 2017</small>
        </p>

        <aside class="notes">
            <ul>
                <li>30 minutes talk</li>
            </ul>
        </aside>
    </section>
    <section>
        <h3>About me</h3>

        <p>Sławomir Śledź</p>

        <img src="https://www.gravatar.com/avatar/ccd7a764d62ec150d1a6c48518835736" alt="Sławomir Śledź"
             style="border: 1px; border-radius: 20px">

        <p>Senior Java Developer</p>

        <p><i class="fa fa-github"></i>&nbsp;<a href="http://ssledz.github.io">ssledz.github.io</a></p>
    </section>
    <section>
        <h2>The Talk</h2>

        <aside class="notes">
            <ul>
                <li>sample note 1.</li>
                <li>sample note 2.</li>
            </ul>
        </aside>
    </section>
</section>

<section>

    <section>

        <h3>Bash</h3>
        <p>
            Bash is an sh-compatible command language interpreter that executes commands read
            from the standard input or from a file.
        </p>

        <aside class="notes">
            Programming language through which a user communicates with the operating system or an application
        </aside>

    </section>

    <section>
        <h3>Strong sides</h3>

        <ul>
            <li>easy to learn</li>
            <li>available out of the box on most linux distributions</li>
            <li>piping</li>
            <li>flexible i/o redirection</li>
            <li>painless concurrency</li>
            <li>simple type system (everything is a string)</li>
            <li>local variables, read only variables (but who is using them ?)</li>
        </ul>

    </section>

    <section>
        <h3>Weak sides</h3>

        <ul>
            <li>arrays suck</li>
            <li>associative arrays (dictionaries) suck</li>
            <li>syntax for if, for, while, case,... statements is hard to remember</li>
            <li>many traps for beginners</li>
            <li>is slow</li>
            <li>global variables</li>
            <li>debugging is painful</li>
            <li>functions can only return numbers (status code)</li>
        </ul>

        <aside class="notes">
            <ul>
                <li>associative arrays since bash 4</li>
            </ul>
        </aside>

    </section>
    <section data-transition="slide" data-background="#b5533c" data-background-transition="zoom">
        <h4>Common mistakes</h4>
        <p>
            What does echo print ?
        </p>
        <pre><code class="hljs" data-trim contenteditable>
                cnt=0; cat /proc/meminfo | while read line; do

                    cnt=$((cnt+1))

                done

                echo $cnt
        </code></pre>
    </section>

    <section data-transition="slide" data-background="#4d7e65" data-background-transition="zoom">
        <h4>Common mistakes</h4>
        <p>
            Now echo prints correctly the number of lines of the meminfo pseudo file.
        </p>
        <pre><code class="hljs" data-trim contenteditable>
                cnt=0; while read line; do

                    cnt=$((cnt+1))

                done < /proc/meminfo

                echo $cnt
        </code></pre>
    </section>

    <section data-transition="slide" data-background="#b5533c" data-background-transition="zoom">
        <h4>Common mistakes</h4>
        <p>
            Does it print 'xxx' ?
        </p>
        <pre><code class="hljs" data-trim contenteditable>
                echo -n 'xxx' | while read line; do

                    echo $line;

                done
        </code></pre>
    </section>

    <section data-transition="slide" data-background="#4d7e65" data-background-transition="zoom">
        <h4>Common mistakes</h4>
        <p>
            Now it prints 'xxx' !
        </p>
        <pre><code class="hljs" data-trim contenteditable>
                 echo -n 'xxx' | while read line || [ -n "$line" ]; do

                    echo $line;

                 done
        </code></pre>
    </section>

    <section data-background="../images/presentation/fun-sh/fun-sh.png">
    </section>

    <section>
        <p>What can we do to make programming in bash more pleasant ?</p>
        <p class="fragment fade-up">What makes haskel programmers so happy ?</p>
        <p class="fragment fade-up">What is functional programming ?</p>
        <p class="fragment fade-up">Can we adapt some parts of it in bash ?</p>
    </section>

</section>

<section>
    <section>
        <h3>Functional programming</h3>
        <p>In computer science, <em>functional programming</em> is a programming paradigm—a style of building the structure
            and elements of computer programs—that treats computation as the evaluation of mathematical
            functions and avoids changing-state and mutable data.</p>

        <aside class="notes">
            <ul>
                <li>programming done with expressions or declarations instead of statements</li>
                <li>output of the function depends only on the arguments</li>
            </ul>
        </aside>

    </section>
    <section>
        <h4>Good parts</h4>
        <ul>
            <li>easier to understand and predict the behavior of a program</li>
            <li class="fragment fade-up">plays extremely nice with the rising multi-core technology (concurrency)</li>
            <li class="fragment fade-up">many algorithms can be defined in recursive manner</li>
            <li class="fragment fade-up">more concise code (comparing to imperative style)</li>
            <li class="fragment fade-up">better readable code - encourage decoupling / modular design (comparing to imperative style)</li>
        </ul>

        <aside class="notes">
            <p>
                thanks to the fact that there is no state and no data mutation it is easier to write concurrent programs
            </p>
        </aside>

    </section>
    <section>
        <h4>Good parts...</h4>
        <ul>
            <li>employs some really nice abstractions to solve problems in very generic way (monads, option, lazy, memo, pattern matching, currying)</li>
            <li class="fragment fade-up">make you think about problems in more abstract / mathematical way</li>
        </ul>

        <aside class="notes">
            <p>
                <b>Currying</b> is when you break down a function that takes multiple arguments into a series
                of functions that take part of the arguments.
            </p>

            <p>
                <b>Memoization</b> is a technique for optimizing functions.  Every time a memoized function
                is called the result is caches with reference to the given parameters.
            </p>

        </aside>

    </section>
    <section>
        <h4>Bad parts</h4>

        <ul>
            <li>real-world programs are not stateless</li>
            <li class="fragment fade-up">
                with immutable data structures you have cheap thread safety at the cost of memory consumption
            </li>
            <li class="fragment fade-up">
                usually programs are shorter and easier to read except the cases where
                they are longer and harder to read <span class="fragment highlight-red">:)</span> (depends on the experience)
            </li>
            <li class="fragment fade-up">
                productivity goes up in order to hire very expensive programmers who
                know how to program in a functional style
            </li>
            <li class="fragment fade-up">
                it takes some time to be efficient in functional programming
            </li>
        </ul>
    </section>
</section>

<section>
    <h3>fun-bash a quick start</h3>

    <p>
        Available on GitHub <i class="fa fa-github"></i>&nbsp;<a href="https://github.com/ssledz/bash-fun">bash-fun</a>
    </p>

    <pre class="fragment current-visible"><code class="hljs" data-trim contenteditable>
        #!/bin/bash
        . <(curl -Ls goo.gl/8JeMbR)

        seq 1 4 | sum
    </code></pre>

    <div class="fragment current-visible">
    <p>
        download <a href="https://raw.githubusercontent.com/ssledz/bash-fun/master/src/fun.sh">fun.sh</a> and
    </p>

    <pre><code class="hljs" data-trim contenteditable>
        #!/bin/bash
        . fun.sh

        seq 1 4 | sum
    </code></pre>
    </div>

    <div class="fragment current-visible">
        <pre><code class="hljs" data-trim contenteditable>
            #!/bin/bash
            . <(test -e fun.sh || curl -Ls goo.gl/8JeMbR > fun.sh; cat fun.sh)

            seq 1 4 | sum
        </code></pre>
    </div>

</section>

<section>
    <h4>Example of usage</h4>
    <pre><code class="hljs" data-trim contenteditable>
#!/bin/bash

. fun.sh

backup_dir=/home/adserver/backup
max_backups=10

ls -1 $backup_dir | grep adserver-active- \
  | map λ a . 'echo $a; echo $a | strip adserver-active-1080- | strip adserver-active-1081-' \
  | buff λ a b . 'date=$(echo $b | cut -dT -f1); tup $a $date' \
  | sort -t ',' -k2 -r \
  | drop $max_backups \
  | map λ a . 'echo -n $backup_dir/; tupl $a' \
  | xargs rm -rf
    </code></pre>
    <pre><code class="hljs" data-trim contenteditable>
> ls  /home/adserver/backup | head -5

adserver-active-1080-2017-05-22T134440
adserver-active-1080-2017-05-23T143705
adserver-active-1080-2017-05-29T110500
adserver-active-1080-2017-05-30T110812
adserver-active-1080-2017-06-20T130354
    </code></pre>
</section>